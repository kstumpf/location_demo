from django.shortcuts import render_to_response, redirect, render
from django.http import HttpResponseRedirect
from .models import Proverb, Location

from forms import ProverbForm
from locations.forms import LocationForm
from django.core.context_processors import csrf


from django_ajax.decorators import ajax

# Create your views here.
def home(request):
    return render(request, 'home.html')

def prov_list(request):
    proverbs = Proverb.objects.all()
    context = {}
    context['proverbs'] = proverbs

    return render_to_response('prov_list.html', context)


def prov_detail(request, pk, *args, **kwargs):
    proverb = Proverb.objects.get(pk=pk)
    context = {}
    context['proverb'] = proverb

    return render_to_response('prov_detail.html', context)


#@ajax
def prov_create(request):
    if request.method == 'POST':
        form = ProverbForm(request.POST)
        if form.is_valid():
            form.save()
            if request.is_ajax():
                return render(request, 'prov_list.html')
            else:
                return redirect('/prov_list/')
    else:
        form = ProverbForm()

    context = {}
    context.update(csrf(request))    
    context['form'] = form
    
    return render_to_response('prov_create.html', context)


def prov_edit(request, pk):
    proverb = Proverb.objects.get(pk=pk)
    if request.POST:
        form = ProverbForm(request.POST, instance = proverb)
        if form.is_valid():
            form.save()
            if request.is_ajax():
                return render(request, 'prov_list.html')
            else:
                return redirect('/prov_list/')
    else:
        form = ProverbForm(instance = proverb)

    context = {}
    context.update(csrf(request))
    context['form'] = form
    context['pk'] = pk

    return render_to_response('prov_edit.html', context)
